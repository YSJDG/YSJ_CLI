# YSJ_CLI v1.0 说明文档

## 介绍

YSJ_CLI是一个便携式命令行环境脚本，可以实现将某些目录临时添加到path、设置环境变量、在命令行启动软件等功能。

YSJ_CLI完全基于CMDShell开发，适用于绝大多数Windows环境。

## 工作原理

脚本会根据 **工具配置文件** 的内容，在 `Dir_Share` 这个共享文件夹生成启动脚本，只要将这个文件夹添加到 `path` 环境变量，就可以实现软件的启动

 **工具配置文件** 还可以设置环境变量的操作，由此可以将用户文件夹（如AppData）设置到其它目录，以此来实现便携环境的创建

插件的实现是通过遍历插件文件夹下所有的.cmd脚本实现的，参见插件的使用

## 使用方法（适用于1.0版本）

首次运行会自动执行一次安装并生成 `AutoRun.cmd` 这个脚本会在每次安装时重新生成，如果存在这个脚本，

### 配置项说明

可以按照自身需求修改 `::配置` 下的内容

如果觉得命令行参数用起来不习惯，可以修改 `::命令行参数` 下的内容，但是本说明文档是按照默认配置写的

不要修改 `::不要随意修改` 下的内容，除非你知道你在做什么

#### ::配置

| 变量名 | 默认值 | 说明 |
| - | - | - |
| `YSJ_Version` | 3.0 | 当前版本 |
| `Dir_Root` | %~dp0Bin\ | 根目录位置，脚本会在这个目录下搜索 **工具配置文件** |
| `Dir_Plugins` | %Dir_Root%.Plugins\ | 插件目录， `-p` 参数会调用这个目录下的脚本 |
| `Dir_Work` | | 工作目录，脚本在执行后会自动移动到该目录 |
| `Name_Tools` | tool | 指定 **工具配置文件** 的扩展名 |
| `ActiveCodePage` | 65001 | 设置启用的代码页 |
| `Editor` | notepad.exe | 设置默认文本编辑器 |
| `Explorer` | explorer.exe | 设置默认文件管理器 |
| `Terminal` | cmd.exe | 设置默认终端 |

#### ::命令行参数

| 参数 | 对应变量 | 说明 |
| - | - | - |
| `-h` | `Arg_Help` | 显示帮助信息 |
| `-i` | `Arg_Install` | 安装工具、注册路径 |
| `-p` | `Arg_Plugins` | 使用插件 |
| `-e` | `Arg_EditScript` | 编辑脚本 |
| `??` | `Arg_Where` | 打开软件目录 |
| `???` | `Arg_ToolInfo` | 显示软件说明 |

#### ::不要随意修改

| 变量 | 说明 |
| - | - |
| `Script_AutoRun` | 指定启动脚本路径（如果修改这个，需要更改安装部分 `::Fix line1` 的内容） |
| `Dir_Share` | 指定软件启动脚本文件夹路径（如果修改这个，需要修改安装部分 `::Create Script` 的内容） |

### 工具配置文件的格式

配置文件的核心是第一行，内容为：软件的启动方式 & 要执行的操作

（绝大多数情况下是 `start` 和 `call` 或者 `explorer.exe`）

脚本会使用这个命令去打开目标文件，有几个特殊的参数会被修正

| 参数 | 修正说明 |
| - | - |
| `start /d` | 该参数会被加上 `Dir_Share` 到软件目录的相对路径，用于启动某些需要在软件目录启动的软件 |
| `addpath` | 该参数会将本文件所在的目录添加到 `path` 环境变量 |
| `dironly` | 该参数会将本文件第二行设置为环境变量，值为：所在的目录 |
| `stronly` | 该参数会将本文件第二行设置为环境变量，值为：第三行 |
| `setfull` | 该参数会将本文件第二行设置为环境变量，值为：当前所在目录\第三行 |

按照要求填写第二、第三行即可

脚本会在 `Dir_Share` 生成一个名称为 **本配置文件文件名.cmd** 的启动脚本，内容如下（实际脚本中被压缩成了一行）

```CMD
@if "%%~1" equ "??" (
	call %Explorer% 目标文件所在文件夹（相对路径）
) else if "%%~1" equ "???" (
	echo 启动脚本名称 | 工具说明（文件第三行）
) else (
	启动方式 目标文件所在文件夹路径\目标文件名称（第二行） %*
)
```

### 插件的使用

使用 `-p` `-h` 参数可以显示当前所有插件的使用说明

如果想要编写插件，可以参照下面的模板

```CMD
@echo off

::插件入口 
set Arg=插件的启动参数 
if "%~1" neq "-p" exit /b
if "%~2" equ "%Arg_Help%" (
	::在此处填写帮助信息 
)
if "%~2" neq "%Arg%" exit /b
if "%~3" equ "%Arg_EditScript%" (
    call %Editor% %~f0
    exit /b
)
set Arg=

::Main
::插件的主要功能实现 
```
